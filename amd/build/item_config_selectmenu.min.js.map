{"version":3,"file":"item_config_selectmenu.min.js","sources":["../src/item_config_selectmenu.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for select menu option configuration.\n *\n * @module      mod_trainingevaluation/item_config_selectmenu\n * @copyright   Pelorus Labs\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\n\n/**\n * Listen for DOM changes to initialize the select menu configuration interface when ready.\n */\nexport const init = () => {\n    const initWhenReady = () => {\n        const container = document.getElementById('selectmenu-options-container');\n        const addButton = document.getElementById('selectmenu-add-option');\n        const hiddenInput = document.getElementById('editselectmenuoptions');\n\n        if (container && addButton && hiddenInput) {\n            initSelectMenu(container, addButton, hiddenInput);\n            return true;\n        }\n        return false;\n    };\n\n    // Try immediate initialization\n    if (initWhenReady()) {\n        return;\n    }\n\n    // If not ready, watch for DOM changes\n    const observer = new MutationObserver((mutations, obs) => {\n        if (initWhenReady()) {\n            obs.disconnect();\n        }\n    });\n\n    observer.observe(document.body, {\n        childList: true,\n        subtree: true\n    });\n\n    // Fallback timeout to stop observing after 5 seconds\n    setTimeout(() => observer.disconnect(), 5000);\n};\n\n/**\n * Initialize the select menu configuration interface\n *\n * @param {HTMLElement} container\n * @param {HTMLElement} addButton\n * @param {HTMLElement} hiddenInput\n */\nconst initSelectMenu = (container, addButton, hiddenInput) => {\n    if (!container || !addButton || !hiddenInput) {\n        return;\n    }\n\n    addButton.addEventListener('click', async () => {\n        if (anyEmptyInputs()) {\n            return;\n        }\n        const optionRow = document.createElement('div');\n        optionRow.className = 'input-group mb-2 selectmenu-option-row';\n\n        const placeholder = await getString('enteroption', 'mod_trainingevaluation');\n\n        optionRow.innerHTML = `\n            <input type=\"text\" class=\"form-control selectmenu-option-input\"\n                   value=\"\" placeholder=\"${placeholder}\" />\n            <div class=\"input-group-append\">\n                <button type=\"button\" class=\"btn btn-danger selectmenu-remove-option\">\n                    <i class=\"fa fa-trash\"></i>\n                </button>\n            </div>\n        `;\n\n        container.appendChild(optionRow);\n\n        // Focus the new input\n        optionRow.querySelector('.selectmenu-option-input').focus();\n\n        // Attach remove handler\n        optionRow.querySelector('.selectmenu-remove-option')\n            .addEventListener('click', () => removeOption(optionRow));\n\n        updateHiddenInput();\n    });\n\n    const removeOption = (row) => {\n        // Keep at least one option row\n        const rows = container.querySelectorAll('.selectmenu-option-row');\n        if (rows.length > 1) {\n            row.remove();\n            updateHiddenInput();\n        } else {\n            // Just clear the input if it's the last one\n            row.querySelector('.selectmenu-option-input').value = '';\n            updateHiddenInput();\n        }\n    };\n\n    const anyEmptyInputs = () => {\n        const inputs = container.querySelectorAll('.selectmenu-option-input');\n        return Array.from(inputs).some(input => input.value.trim() === '');\n    };\n\n    const updateHiddenInput = () => {\n        const inputs = container.querySelectorAll('.selectmenu-option-input');\n        const options = [];\n\n        inputs.forEach((input, i) => {\n            const value = input.value.trim();\n            if (value !== '') {\n                options.push({'id': i, 'value': value});\n            }\n        });\n\n        hiddenInput.value = JSON.stringify(options);\n    };\n\n    // Attach remove handlers to existing rows\n    container.querySelectorAll('.selectmenu-remove-option').forEach(button => {\n        button.addEventListener('click', (e) => {\n            const row = e.target.closest('.selectmenu-option-row');\n            removeOption(row);\n        });\n    });\n\n    // Update hidden input on any input change\n    container.addEventListener('input', (e) => {\n        if (e.target.classList.contains('selectmenu-option-input')) {\n            updateHiddenInput();\n        }\n    });\n\n    // Initial update\n    updateHiddenInput();\n};"],"names":["initWhenReady","container","document","getElementById","addButton","hiddenInput","initSelectMenu","observer","MutationObserver","mutations","obs","disconnect","observe","body","childList","subtree","setTimeout","addEventListener","async","anyEmptyInputs","optionRow","createElement","className","placeholder","innerHTML","appendChild","querySelector","focus","removeOption","updateHiddenInput","row","querySelectorAll","length","remove","value","inputs","Array","from","some","input","trim","options","forEach","i","push","JSON","stringify","button","e","target","closest","classList","contains"],"mappings":"kMA4BoB,WACVA,cAAgB,WACZC,UAAYC,SAASC,eAAe,gCACpCC,UAAYF,SAASC,eAAe,yBACpCE,YAAcH,SAASC,eAAe,kCAExCF,WAAaG,WAAaC,eAC1BC,eAAeL,UAAWG,UAAWC,cAC9B,OAMXL,6BAKEO,SAAW,IAAIC,kBAAiB,CAACC,UAAWC,OAC1CV,iBACAU,IAAIC,gBAIZJ,SAASK,QAAQV,SAASW,KAAM,CAC5BC,WAAW,EACXC,SAAS,IAIbC,YAAW,IAAMT,SAASI,cAAc,YAUtCL,eAAiB,CAACL,UAAWG,UAAWC,mBACrCJ,YAAcG,YAAcC,mBAIjCD,UAAUa,iBAAiB,SAASC,aAC5BC,8BAGEC,UAAYlB,SAASmB,cAAc,OACzCD,UAAUE,UAAY,+CAEhBC,kBAAoB,mBAAU,cAAe,0BAEnDH,UAAUI,4IAEyBD,oQAQnCtB,UAAUwB,YAAYL,WAGtBA,UAAUM,cAAc,4BAA4BC,QAGpDP,UAAUM,cAAc,6BACnBT,iBAAiB,SAAS,IAAMW,aAAaR,aAElDS,6BAGED,aAAgBE,MAEL7B,UAAU8B,iBAAiB,0BAC/BC,OAAS,GACdF,IAAIG,SACJJ,sBAGAC,IAAIJ,cAAc,4BAA4BQ,MAAQ,GACtDL,sBAIFV,eAAiB,WACbgB,OAASlC,UAAU8B,iBAAiB,mCACnCK,MAAMC,KAAKF,QAAQG,MAAKC,OAAgC,KAAvBA,MAAML,MAAMM,UAGlDX,kBAAoB,WAChBM,OAASlC,UAAU8B,iBAAiB,4BACpCU,QAAU,GAEhBN,OAAOO,SAAQ,CAACH,MAAOI,WACbT,MAAQK,MAAML,MAAMM,OACZ,KAAVN,OACAO,QAAQG,KAAK,IAAOD,QAAYT,WAIxC7B,YAAY6B,MAAQW,KAAKC,UAAUL,UAIvCxC,UAAU8B,iBAAiB,6BAA6BW,SAAQK,SAC5DA,OAAO9B,iBAAiB,SAAU+B,UACxBlB,IAAMkB,EAAEC,OAAOC,QAAQ,0BAC7BtB,aAAaE,WAKrB7B,UAAUgB,iBAAiB,SAAU+B,IAC7BA,EAAEC,OAAOE,UAAUC,SAAS,4BAC5BvB,uBAKRA"}